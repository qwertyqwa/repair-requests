# Задание 1 — Учет заявок на ремонт (краткая спецификация + алгоритмы)

## 1. Краткая спецификация модуля

**Назначение:** автоматизация учета заявок на ремонт бытовой техники в сервисном центре.

**Роли пользователей:**
- **Оператор / Администратор:** создаёт и редактирует заявки, назначает мастера, меняет статус, удаляет заявки.
- **Мастер:** видит только назначенные ему заявки, меняет статус, добавляет комментарий и сведения о запчастях/материалах.

**Основные функции:**
1. Создание заявки.
2. Просмотр списка заявок и статусов.
3. Поиск заявки по номеру или параметрам.
4. Редактирование заявки (описание, статус, мастер).
5. Работа мастера по заявке (статус, комментарий, запчасти/материалы).
6. Расчёт статистики (выполнено, среднее время ремонта, по типам неисправностей).

## 2. Входные и выходные данные

### 2.1. Входные данные (форма заявки)
- **Вид техники** (строка, обязательно)
- **Модель** (строка, обязательно)
- **Тип неисправности** (значение из списка, необязательно)
- **Описание проблемы** (текст, обязательно)
- **ФИО клиента** (строка, обязательно)
- **Телефон** (10–15 цифр, обязательно)
- **Статус** (новая / в ремонте / ожидание запчастей / готова к выдаче)
- **Ответственный мастер** (логин мастера, необязательно)
- **Комментарий мастера** (текст, необязательно)
- **Запчасти/материалы** (текст, необязательно)

### 2.2. Выходные данные
- Список заявок с отображением статуса и мастера.
- Карточка заявки.
- Результаты поиска (список заявок).
- Уведомления пользователю (успех/ошибка/информация/предупреждение).
- Статистика: количество выполненных заявок, среднее время ремонта, распределение по типам неисправностей.

## 3. Основной алгоритм учета заявок (текст по ГОСТ 24.301)

1. Пользователь выполняет вход в систему.
2. Система определяет роль пользователя и разрешённые действия.
3. Пользователь выбирает действие:
   1) создание заявки;
   2) просмотр списка заявок;
   3) поиск заявки;
   4) работа по заявке (для мастера);
   5) просмотр статистики.
4. При создании заявки:
   1) система отображает форму ввода;
   2) пользователь вводит данные;
   3) система выполняет проверку обязательных полей и корректности телефона;
   4) при ошибках отображает сообщения и возвращает на форму;
   5) при успехе присваивает уникальный номер и сохраняет заявку.
5. При редактировании заявки:
   1) система загружает выбранную заявку;
   2) система проверяет права доступа;
   3) пользователь изменяет разрешённые поля;
   4) система валидирует данные;
   5) система сохраняет изменения и при смене статуса формирует уведомление.
6. При выполнении заявки мастером:
   1) система показывает назначенные мастеру заявки;
   2) мастер открывает заявку и изменяет статус/комментарии;
   3) система сохраняет изменения; при переводе в «В ремонте» фиксирует время начала, при переводе в «Готова» фиксирует время завершения.
7. При расчёте статистики система формирует выходные показатели по сохранённым данным.

## 4. Основной алгоритм (таблица по ГОСТ 2.105 — упрощённо)

| Шаг | Действие | Вход | Выход |
|---:|---|---|---|
| 1 | Авторизация | логин, пароль | активная сессия, роль |
| 2 | Выбор операции | команда пользователя | переход на форму |
| 3 | Создание заявки | поля заявки | сохранённая заявка с номером |
| 4 | Редактирование | номер заявки, новые значения | обновлённая заявка, уведомление |
| 5 | Поиск | строка запроса, фильтр статуса | список найденных заявок / сообщение «не найдено» |
| 6 | Работа мастера | статус/комментарии/запчасти | обновлённая заявка, фиксация дат |
| 7 | Статистика | список заявок | показатели (кол-во, среднее время, распределение) |

## 5. Детализация функции «Среднее время ремонта» (алгоритм)

### 5.1. Вход/выход
- **Вход:** список выполненных заявок (статус «Готова»), у каждой есть `completed_at`, а время начала берётся как `started_at` (если есть) иначе `created_at`.
- **Выход:** среднее время ремонта (длительность) или «нет данных».

### 5.2. Алгоритм (таблица)

| Шаг | Описание |
|---:|---|
| 1 | Отобрать заявки со статусом «Готова» и заполненным временем завершения. |
| 2 | Для каждой заявки вычислить длительность: `duration = completed_at - (started_at или created_at)`. |
| 3 | Исключить заявки с некорректной длительностью (duration < 0). |
| 4 | Если список длительностей пуст — вернуть «нет данных». |
| 5 | Просуммировать длительности и разделить на количество заявок. |
| 6 | Вернуть среднее значение. |

## 6. Интерфейс (формы/страницы)

- `Вход` — ввод логина/пароля.
- `Заявки` — список заявок + фильтр по статусу.
- `Новая заявка` — создание заявки (оператор/администратор).
- `Карточка заявки` — подробная информация.
- `Редактирование заявки` — изменение данных заявки (оператор/администратор).
- `Работа мастера` — изменение статуса/комментариев/запчастей (мастер).
- `Поиск` — поиск по номеру/параметрам.
- `Статистика` — показатели по заявкам.

