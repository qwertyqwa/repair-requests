{% extends "base.html" %}
{% set title = "Заявки" %}

{% block content %}
  <div class="pagehead">
    <h1>Заявки</h1>
    <div class="pagehead__actions">
      {% if can_manage %}
        <a class="btn btn--primary" href="{{ url_for('web.request_new') }}">Создать заявку</a>
      {% endif %}
    </div>
  </div>

  <form class="filters" method="get" action="{{ url_for('web.index') }}">
    <label class="field">
      <span class="field__label">Статус</span>
      <select class="field__input" name="status">
        <option value="" {% if not status_filter %}selected{% endif %}>Все</option>
        {% for value, label in status_choices %}
          <option value="{{ value }}" {% if status_filter == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </label>
    <button class="btn" type="submit">Применить</button>
    {% if status_filter %}
      <a class="btn btn--link" href="{{ url_for('web.index') }}">Сбросить</a>
    {% endif %}
  </form>

  {% if requests %}
    <div class="tablewrap">
      <table class="table">
        <thead>
          <tr>
            <th>№</th>
            <th>Дата</th>
            <th>Срок</th>
            <th>Техника</th>
            <th>Клиент</th>
            <th>Телефон</th>
            <th>Статус</th>
            <th>Мастер</th>
          </tr>
        </thead>
        <tbody>
          {% for r in requests %}
            <tr>
              <td><a href="{{ url_for('web.request_detail', number=r.number) }}">№{{ r.number }}</a></td>
              <td>{{ r.created_at|dt }}</td>
              <td>{{ r.due_at|dt }}</td>
              <td>{{ r.appliance_type }} — {{ r.appliance_model }}</td>
              <td>{{ r.client_name }}</td>
              <td>{{ r.client_phone }}</td>
              <td>{{ r.status|status_label }}</td>
              <td>{{ r.technician_username or "—" }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="empty">
      <p>Заявок пока нет.</p>
    </div>
  {% endif %}
{% endblock %}
